function netlab_ip()
{
	ns=`netlab_netns $1`
	shift
	ip -n $ns $*
}

function nl_netns()
{
	N=$1
	ip netns add `netlab_netns $1`
}

function nl_route()
{
	N=$1
	shift

	netlab_ip $N route add $*
}

function if_dummy()
{
	ns=`netlab_netns $1`
	ip link add name $2 netns $ns type dummy

	netlab_ip $1 addr add ${3}.1/24 dev $2
	netlab_ip $1 link set $2 up
}

function if_veth()
{
	ns1=`netlab_netns $1`
	ns2=`netlab_netns $2`
	name1=veth-$2
	name2=veth-$1
	addr=$3

	ip link add name $name1 netns $ns1 type veth peer name $name2 netns $ns2

	ip netns exec $ns1 ip link set $name1 up
	ip netns exec $ns2 ip link set $name2 up
	ip netns exec $ns1 ip addr add ${addr}.1/24 dev $name1
	ip netns exec $ns2 ip addr add ${addr}.2/24 dev $name2
}

function if_bridge()
{
	N=$1
	name=$1
	addr=$2

	nl_netns $N
	netlab_ip $N link add name $name type bridge

	netlab_ip $N addr add ${addr}/24 dev $name
	netlab_ip $N link set $name up
}

function if_plug()
{
	N=$1
	br=$2
	addr=$3
	nsn=`netlab_netns $N`
	nsbr=`netlab_netns $br`

	ip link add name veth-$N netns $nsbr type veth peer name veth-$br netns $nsn

	netlab_ip $N addr add ${addr}/24 dev veth-$br
	netlab_ip $N  link set veth-$br up

	netlab_ip $br link set veth-$N master $br
	netlab_ip $br link set veth-$N up
	netlab_ip $br link set $br up
}
